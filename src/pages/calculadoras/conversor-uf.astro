---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
---

<Layout
  title="Conversor UF a Pesos Chile | Tu Plata Informa"
  description="Convierte UF a CLP y CLP a UF con valor diario de referencia y una tabla r√°pida de montos."
>
  <Header />
  <main id="main-content" class="app-layout">
    <section class="border-b border-border pt-8 pb-6">
      <h1 class="my-4 text-3xl font-bold sm:text-4xl">
        üîÑ Conversor UF ‚Üî Pesos
      </h1>
      <p class="max-w-xl text-foreground/70">
        Convierte entre Unidad de Fomento y pesos chilenos al valor oficial del d√≠a. Sin registro, sin publicidad.
      </p>
    </section>

    <section class="py-8 max-w-xl">
      <!-- VALOR DEL D√çA -->
      <div id="valor-uf-banner" class="mb-6 rounded-xl border border-accent/30 bg-accent/5 p-4 flex items-center justify-between gap-4">
        <div>
          <p class="text-xs font-bold uppercase tracking-widest text-accent mb-0.5">Valor UF hoy</p>
          <p id="uf-display" class="text-3xl font-bold">$39.773,62</p>
          <p id="uf-fecha" class="text-xs text-foreground/50 mt-0.5">25 de febrero de 2026 ¬∑ Fuente: Banco Central</p>
        </div>
        <span class="text-4xl">üá®üá±</span>
      </div>

      <!-- CONVERSOR -->
      <div class="rounded-xl border border-border p-6 mb-6">
        <!-- UF ‚Üí Pesos -->
        <div class="mb-6">
          <label for="uf-input" class="mb-1 block text-sm font-medium text-foreground/70">
            Unidades de Fomento (UF)
          </label>
          <input
            type="number" id="uf-input" placeholder="Ej: 1000" min="0" step="0.01"
            class="w-full rounded-lg border border-border bg-background px-3 py-2 text-foreground focus:border-accent focus:outline-none text-lg"
          />
        </div>

        <div class="flex items-center gap-3 mb-6">
          <div class="flex-1 h-px bg-border"></div>
          <button id="swap-btn" class="rounded-full border border-border px-3 py-1 text-sm text-foreground/60 hover:border-accent hover:text-accent transition-all">
            ‚áÖ invertir
          </button>
          <div class="flex-1 h-px bg-border"></div>
        </div>

        <div class="mb-6">
          <label for="pesos-input" class="mb-1 block text-sm font-medium text-foreground/70">
            Pesos chilenos ($)
          </label>
          <input
            type="number" id="pesos-input" placeholder="Ej: 39.773.620" min="0"
            class="w-full rounded-lg border border-border bg-background px-3 py-2 text-foreground focus:border-accent focus:outline-none text-lg"
          />
        </div>

        <!-- RESULTADO VISUAL -->
        <div id="resultado" class="hidden rounded-lg bg-foreground/5 p-4 text-center">
          <p id="resultado-texto" class="text-2xl font-bold"></p>
          <p id="resultado-sub" class="text-sm text-foreground/50 mt-1"></p>
        </div>
      </div>

      <!-- TABLA DE REFERENCIA R√ÅPIDA -->
      <div class="rounded-xl border border-border p-6">
        <h2 class="text-base font-semibold mb-4">Valores de referencia r√°pidos</h2>
        <div id="tabla-ref" class="space-y-2 text-sm"></div>
      </div>
    </section>

    <section class="prose prose-sm max-w-none border-t border-border pt-8 pb-12 dark:prose-invert">
      <h2>¬øQu√© es la UF y por qu√© cambia cada d√≠a?</h2>
      <p>
        La <strong>Unidad de Fomento (UF)</strong> es un √≠ndice de reajustabilidad que sigue la inflaci√≥n. Se actualiza diariamente desde el d√≠a 10 de cada mes hasta el d√≠a 9 del siguiente, en base al IPC del mes anterior publicado por el INE.
      </p>
      <ul>
        <li>Si el IPC de enero fue 0,5%, la UF sube ese 0,5% distribuido entre el 10 de febrero y el 9 de marzo.</li>
        <li>El valor oficial lo publica el Banco Central en el Diario Oficial a m√°s tardar el d√≠a 9 de cada mes.</li>
        <li>Se usa en arriendos, cr√©ditos hipotecarios, multas y contratos de largo plazo.</li>
      </ul>
      <p class="text-sm text-foreground/50">
        ‚ö†Ô∏è El valor de la UF en este conversor es referencial (25/02/2026: $39.773,62). Para el valor exacto del d√≠a consulta el <a href="https://si3.bcentral.cl/Indicadoressiete/secure/Indicadoresdiarios.aspx" target="_blank">Banco Central</a> o el <a href="https://www.sii.cl/valores_y_fechas/uf/uf2026.htm" target="_blank">SII</a>.
      </p>
    </section>
  </main>
  <Footer />
</Layout>

<script>
  const UF_VALOR = 39773.62;

  const fmt = (n: number) => "$" + Math.round(n).toLocaleString("es-CL");
  const fmtUF = (n: number) => n.toLocaleString("es-CL", { minimumFractionDigits: 2, maximumFractionDigits: 4 }) + " UF";

  const ufInput = document.getElementById("uf-input") as HTMLInputElement;
  const pesosInput = document.getElementById("pesos-input") as HTMLInputElement;
  const resultado = document.getElementById("resultado")!;
  const resultadoTexto = document.getElementById("resultado-texto")!;
  const resultadoSub = document.getElementById("resultado-sub")!;

  function mostrarResultado(principal: string, sub: string) {
    resultado.classList.remove("hidden");
    resultadoTexto.textContent = principal;
    resultadoSub.textContent = sub;
  }

  ufInput.addEventListener("input", () => {
    const uf = parseFloat(ufInput.value);
    if (!isNaN(uf) && uf > 0) {
      const pesos = uf * UF_VALOR;
      pesosInput.value = String(Math.round(pesos));
      mostrarResultado(fmt(pesos), `${fmtUF(uf)} = ${fmt(pesos)} al 25/02/2026`);
    } else {
      pesosInput.value = "";
      resultado.classList.add("hidden");
    }
  });

  pesosInput.addEventListener("input", () => {
    const pesos = parseFloat(pesosInput.value);
    if (!isNaN(pesos) && pesos > 0) {
      const uf = pesos / UF_VALOR;
      ufInput.value = uf.toFixed(4);
      mostrarResultado(fmtUF(uf), `${fmt(pesos)} = ${fmtUF(uf)} al 25/02/2026`);
    } else {
      ufInput.value = "";
      resultado.classList.add("hidden");
    }
  });

  document.getElementById("swap-btn")?.addEventListener("click", () => {
    const ufVal = ufInput.value;
    const pesosVal = pesosInput.value;
    ufInput.value = pesosVal ? String(parseFloat(pesosVal) / UF_VALOR) : "";
    pesosInput.value = ufVal ? String(Math.round(parseFloat(ufVal) * UF_VALOR)) : "";
    ufInput.dispatchEvent(new Event("input"));
  });

  // Tabla de referencia
  const refs = [
    { label: "1 UF", uf: 1 },
    { label: "10 UF", uf: 10 },
    { label: "50 UF (tope Ley fraude)", uf: 50 },
    { label: "80 UF (m√≠nimo Superir)", uf: 80 },
    { label: "100 UF", uf: 100 },
    { label: "500 UF", uf: 500 },
    { label: "600 UF (tope APV anual)", uf: 600 },
    { label: "1.000 UF", uf: 1000 },
    { label: "2.000 UF (precio aprox. depto. chico)", uf: 2000 },
  ];

  const tablaEl = document.getElementById("tabla-ref")!;
  tablaEl.innerHTML = refs.map(r =>
    `<div class="flex justify-between py-1.5 border-b border-border last:border-0">
      <span class="text-foreground/60">${r.label}</span>
      <span class="font-mono font-semibold">${fmt(r.uf * UF_VALOR)}</span>
    </div>`
  ).join("");
</script>
